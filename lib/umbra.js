"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}var r=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.AsyncPromisifier=class{exec(t,e){if(Object.defineProperty(t,"name",{value:e,writable:!1}),1===t.length)return new Promise((e,n)=>{t(t=>{t instanceof Error?n(t):e(t)})});try{return Promise.resolve(t())}catch(t){return Promise.reject(t)}}}}));e(r);r.AsyncPromisifier;var s=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class n extends Error{constructor(t,e,n){super(t),this.timeoutMs=n}}e.TimeoutError=n;e.TimeoutPromisifier=class{wrap(t,e){if(e<=0)return t;const r=Date.now();let s=null;const i=new Promise((t,i)=>{s=setTimeout(()=>{const t=Date.now()-r;i(new n(`Async task timeout exceeded! Elapsed: ${t}, timeout: ${e}ms.`,t,e))},e)});return t.catch(()=>{clearTimeout(s)}),Promise.race([t,i]).then(t=>(clearTimeout(s),t))}}}));e(s);s.TimeoutError,s.TimeoutPromisifier;var i=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.mergeConfig=function(t,e){if(!e||"object"!=typeof e)return t;if("object"==typeof t.timeoutMs&&"object"==typeof e.timeoutMs)for(const n of["it","before","beforeEach","after","afterEach"])"number"==typeof e.timeoutMs[n]&&(t.timeoutMs[n]=e.timeoutMs[n]);else void 0!==e.timeoutMs&&(t.timeoutMs=e.timeoutMs);return t.stopOnFirstFail!==e.stopOnFirstFail&&(t.stopOnFirstFail=e.stopOnFirstFail),t}}));e(i);i.mergeConfig;var o=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.DefaultTestRunnerConfig={timeoutMs:100,stopOnFirstFail:!1}}));e(o);o.DefaultTestRunnerConfig;var c=n((function(t,e){function n(t,e){if(!t)return e||[];if(!e)return t;for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function r(t,e){if(!t)return[];const n=t.indexOf(e);return-1!==n&&t.splice(n,1),t}Object.defineProperty(e,"__esModule",{value:!0}),e.union=n,e.without=r;e.SimpleEventEmitter=class{constructor(){this.onListeners={},this.onceListeners={}}on(t,e){this.onListeners[t]=n(this.onListeners[t],[e])}once(t,e){this.onceListeners[t]=n(this.onceListeners[t],[e])}off(t,e){this.onListeners[t]=r(this.onListeners[t],e),this.onceListeners[t]=r(this.onceListeners[t],e)}emit(t,...e){if(this.onListeners[t])for(const n of this.onListeners[t])n.call(null,...e);if(this.onceListeners[t]&&this.onceListeners[t].length>0){for(const n of this.onceListeners[t])n.call(null,...e);this.onceListeners[t]=[]}}emitAndWaitForCompletion(t,...e){const n=[];if(this.onListeners[t])for(const r of this.onListeners[t])try{n.push(Promise.resolve(r.call(null,...e)))}catch(t){n.push(Promise.reject(t))}if(this.onceListeners[t]&&this.onceListeners[t].length>0){for(const r of this.onceListeners[t])try{n.push(Promise.resolve(r.call(null,...e)))}catch(t){n.push(Promise.reject(t))}this.onceListeners[t]=[]}return Promise.all(n).then(t=>{})}}}));e(c);c.union,c.without,c.SimpleEventEmitter;var u=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.QueueStack=class{constructor(){this.queue=[]}pushOnTop(t){0===this.queue.length?this.queue.push([t]):this.queue[0].push(t)}pushStack(t){this.queue.push(t)}popStack(){return this.queue.pop()}shiftStack(){return this.queue.shift()}traverseLevelOrder(t){let e=Promise.resolve();for(let n=0;n<this.queue.length;n++){const r=this.queue[n];for(let n=0;n<r.length;n++)e=e.then(()=>t(r[n]))}return e}traverseInverseLevelOrder(t){let e=Promise.resolve();for(let n=this.queue.length-1;n>=0;n--){const r=this.queue[n];for(let n=r.length-1;n>=0;n--)e=e.then(()=>t(r[n]))}return e}reset(){this.queue=[]}}}));e(u);u.QueueStack;var a=n((function(e,n){var a=t&&t.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function c(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const l=["before","beforeEach","after","afterEach"];n.TestRunner=class{constructor(t,e=new c.SimpleEventEmitter){this.asyncPromisifier=new r.AsyncPromisifier,this.timeoutPromisifier=new s.TimeoutPromisifier,this.testQueueStack=[],this.queueStacks={before:new u.QueueStack,beforeEach:new u.QueueStack,after:new u.QueueStack,afterEach:new u.QueueStack},this.currentTest=null,this.testRunCancelled=!1,this.describe=(t,e)=>{this.throwIfTestInProgress("describe"),this.pushToCurrentTestQueue("describe",t,e)},this.describeOnly=(t,e)=>{this.throwIfTestInProgress("describe.only"),this.pushToCurrentTestQueue("describe",t,e,!0)},this.it=(t,e,n)=>{this.throwIfTestInProgress("it"),this.pushToCurrentTestQueue("it",t,e,!1,n?n.timeoutMs:void 0)},this.itOnly=(t,e,n)=>{this.throwIfTestInProgress("it.only"),this.pushToCurrentTestQueue("it",t,e,!0,n?n.timeoutMs:void 0)},this.runNextTestQueue=()=>a(this,void 0,void 0,(function*(){if(0===this.testQueueStack.length)return;let t=!1;const e=this.testQueueStack.shift();if(null!==e.firstOnlyIndex)t=yield this.executeTest(e,e.tests[e.firstOnlyIndex]);else for(let n=0;n<e.tests.length;n++)t=(yield this.executeTest(e,e.tests[n]))||t;t&&(yield this.evaluateQueueWithTimeout("after"))})),this.throwIfTestInProgress=t=>{if(this.currentTest)throw new Error(`Cannot add an ${t} block while executing a test!`)},this.resetRunResults=()=>{this.runResults={elapsedTimeMs:0,totalTests:0,totalSuccesses:0,totalFailures:0,totalTimeouts:0,failureInfo:[],timeoutInfo:[]}},this.config=i.mergeConfig(o.DefaultTestRunnerConfig,t),this.eventEmitter=e,this.it.only=this.itOnly,this.describe.only=this.describeOnly,this.resetRunResults()}setCurrentFile(t){this.lastFilePathSet=t}on(t,e){this.eventEmitter.on(t,e)}once(t,e){this.eventEmitter.once(t,e)}off(t,e){this.eventEmitter.off(t,e)}before(t){this.throwIfTestInProgress("before"),this.queueStacks.before.pushOnTop(t)}beforeEach(t){this.throwIfTestInProgress("beforeEach"),this.queueStacks.beforeEach.pushOnTop(t)}after(t){this.throwIfTestInProgress("after"),this.queueStacks.after.pushOnTop(t)}afterEach(t){this.throwIfTestInProgress("afterEach"),this.queueStacks.afterEach.pushOnTop(t)}run(){if(this.currentRun)throw new Error("Can't start a test run if one is already in progress!");const t=Date.now();return this.currentRun=this.runNextTestQueue().then(()=>{const e=this.runResults;return e.elapsedTimeMs=Date.now()-t,this.currentRun=null,this.resetRunResults(),e}).catch(t=>{throw this.currentRun=null,t}),this.currentRun}getCurrentTestInfo(){if(!this.currentTest)throw new Error("Can't obtain TestInfo if not actively in a test!");return this.currentTest}reset(){if(this.currentRun)throw new Error("Can't reset if a test run is already in progress!");this.resetRunResults(),this.testRunCancelled=!1,this.testQueueStack=[];for(const t of l)this.queueStacks[t].reset()}cancel(){return this.currentRun?(this.testRunCancelled=!0,this.currentRun.then(t=>(this.reset(),t))):Promise.reject(new Error("Not currently executing a test run! Unable to cancel accordingly."))}pushToCurrentTestQueue(t,e,n,r,s){if(0===this.testQueueStack.length){const t={titleChain:[],tests:[],evaluatedBefores:!1,firstOnlyIndex:r?0:null};this.testQueueStack.push(t)}const i=this.testQueueStack[this.testQueueStack.length-1],o={title:e,type:t,callback:n,absoluteFilePath:this.lastFilePathSet};r&&null===i.firstOnlyIndex&&(i.firstOnlyIndex=i.tests.length),s>0&&(o.timeoutMs=s),i.tests.push(o)}executeTest(t,e){return a(this,void 0,void 0,(function*(){return e.absoluteFilePath!==this.currentlyExecutingFilePath&&(this.currentlyExecutingFilePath=e.absoluteFilePath,this.eventEmitter.emit("activeFileChanged",this.currentlyExecutingFilePath)),!this.testRunCancelled&&("describe"===e.type?this.evaluateDescribe(t,e):this.evaluateTest(t,e))}))}evaluateDescribe(t,e){return a(this,void 0,void 0,(function*(){this.testQueueStack.push({titleChain:[].concat(t.titleChain,e.title),tests:[],evaluatedBefores:!1,firstOnlyIndex:null});for(const t of l)this.queueStacks[t].pushStack([]);this.eventEmitter.emit("beforeDescribe",e.title);const n=Date.now();yield this.asyncPromisifier.exec(e.callback,"describe"),yield this.runNextTestQueue();for(const t of l)"before"===t||"beforeEach"===t?this.queueStacks[t].popStack():this.queueStacks[t].shiftStack();const r=Date.now()-n;return this.eventEmitter.emit("afterDescribe",e.title,r),!1}))}evaluateTest(t,e){return a(this,void 0,void 0,(function*(){t.evaluatedBefores||(t.evaluatedBefores=!0,yield this.evaluateQueueWithTimeout("before")),yield this.evaluateQueueWithTimeout("beforeEach"),this.eventEmitter.emit("beforeTest",e.title),this.currentTest=e;try{yield this.executeTestCallback(e,t.titleChain),yield this.evaluateQueueWithTimeout("afterEach")}finally{this.runResults.totalTests++,this.currentTest=null}return!0}))}executeTestCallback(t,e){return a(this,void 0,void 0,(function*(){const n=Date.now(),r=t.timeoutMs>=0?t.timeoutMs:this.getTimeoutValue("it");try{yield this.timeoutPromisifier.wrap(this.asyncPromisifier.exec(t.callback,"Test: "+t.title),r),yield this.eventEmitter.emitAndWaitForCompletion("beforeTestSuccess",t.title),this.runResults.totalSuccesses++;const e=Date.now()-n;this.eventEmitter.emit("testSuccess",t.title,e)}catch(r){r instanceof s.TimeoutError?(this.runResults.totalTimeouts++,this.runResults.timeoutInfo.push({describeChain:e,title:t.title,elapsedMs:r.elapsedMs,timeoutMs:r.timeoutMs}),this.eventEmitter.emit("testTimeout",t.title,r.elapsedMs,r.timeoutMs)):(this.runResults.totalFailures++,this.runResults.failureInfo.push({describeChain:e,title:t.title,error:r}),this.eventEmitter.emit("testFail",t.title,r,Date.now()-n)),this.config.stopOnFirstFail&&(this.testRunCancelled=!0)}}))}evaluateQueueWithTimeout(t){return this.timeoutPromisifier.wrap(this.evaluateQueue(t),this.getTimeoutValue(t))}evaluateQueue(t){const e=this.queueStacks[t];return"before"===t||"beforeEach"===t?e.traverseLevelOrder(e=>this.asyncPromisifier.exec(e,t)):e.traverseInverseLevelOrder(e=>this.asyncPromisifier.exec(e,t))}getTimeoutValue(t){const e=this.config.timeoutMs;return"number"==typeof e?e:e[t]}}}));e(a);a.TestRunner;var l=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TestRunner=a.TestRunner}));e(l);l.TestRunner;var h=n((function(t,e){function n(t,e){return t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!r(t)||!r(e)||"object"!=typeof t&&"object"!=typeof e?t===e:function(t,e){let s,i,o,c;if(!r(t)||!r(e))return!1;if(t.prototype!==e.prototype)return!1;try{o=Object.keys(t),c=Object.keys(e)}catch(t){return!1}if(o.length!==c.length)return!1;for(o.sort(),c.sort(),s=o.length-1;s>=0;s--)if(o[s]!==c[s])return!1;for(s=o.length-1;s>=0;s--)if(i=o[s],!n(t[i],e[i]))return!1;return typeof t==typeof e}(t,e))}function r(t){return null!=t}Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=n}));e(h);h.deepEqual;var f=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.union=function(t,e){if(!t)return e||[];if(!e)return t;for(const n of e)-1===t.indexOf(n)&&t.push(n);return t},e.without=function(t,e){if(!t)return[];const n=t.indexOf(e);return-1!==n&&t.splice(n,1),t}}));e(f);f.union,f.without;var p=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.SimpleEventEmitter=class{constructor(){this.onListeners={},this.onceListeners={}}on(t,e){this.onListeners[t]=f.union(this.onListeners[t],[e])}once(t,e){this.onceListeners[t]=f.union(this.onceListeners[t],[e])}off(t,e){this.onListeners[t]=f.without(this.onListeners[t],e),this.onceListeners[t]=f.without(this.onceListeners[t],e)}emit(t,...e){if(this.onListeners[t])for(const n of this.onListeners[t])n.call(null,...e);if(this.onceListeners[t]&&this.onceListeners[t].length>0){for(const n of this.onceListeners[t])n.call(null,...e);this.onceListeners[t]=[]}}emitAndWaitForCompletion(t,...e){const n=[];if(this.onListeners[t])for(const r of this.onListeners[t])try{n.push(Promise.resolve(r.call(null,...e)))}catch(t){n.push(Promise.reject(t))}if(this.onceListeners[t]&&this.onceListeners[t].length>0){for(const r of this.onceListeners[t])try{n.push(Promise.resolve(r.call(null,...e)))}catch(t){n.push(Promise.reject(t))}this.onceListeners[t]=[]}return Promise.all(n).then(t=>{})}}}));e(p);p.SimpleEventEmitter;var d=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function n(t,e){return t<e?-1:t>e?1:0}e.SortedArray=class{constructor(t=n,e=[]){this.array=[],this.compareFunction=t||n;const r=e.length;for(let t=0;t<r;t++)this.insert(e[t])}getData(){return this.array}insert(t){let e=this.searchInternal(t)+1;const n=this.array.length-1;for(;e<n&&0===this.compareFunction(t,this.array[e]);)e++;let r=this.array.length;for(this.array.push(t);r>e;)this.array[r]=this.array[--r];this.array[e]=t}search(t){const e=this.searchInternal(t);return 0!==this.compareFunction(this.array[e],t)?-1:e}remove(t){const e=this.search(t);e>=0&&this.array.splice(e,1)}searchInternal(t){let e,n,r=this.array.length-1,s=0;for(;r>=s;)if(e=Math.floor((r+s)/2),n=this.compareFunction(this.array[e],t),n<0)s=e+1;else{if(!(n>0))return e;r=e-1}return r}}}));e(d);d.SortedArray;var g=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.INTERNAL_MOCKER_NAME="__internalMocker",e.printObject=function(t){if(null===t)return"null";if(void 0===t)return"undefined";if(t instanceof RegExp)return t.toString();const e=function(t){const e=t.__internalMocker;return null!=e?e:null}(t);return null!==e?e.mockName:JSON.stringify(t)}}));e(g);g.INTERNAL_MOCKER_NAME,g.printObject;var m=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.any=function(){const t={precedence:-1,matches:()=>!0,description:()=>"any()",equals:e=>e.description()===t.description()};return t},e.gt=function(t){const e={matches:e=>e>t,description:()=>`gt(${g.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.lt=function(t){const e={matches:e=>e<t,description:()=>`lt(${g.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.gte=function(t){const e={matches:e=>e>=t,description:()=>`gte(${g.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.lte=function(t){const e={matches:e=>e<=t,description:()=>`lte(${g.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.eq=function(t){const e={precedence:1,matches:e=>h.deepEqual(t,e),description:()=>g.printObject(t),equals:t=>t.description()===e.description()};return e},e.startsWith=function(t){const e={matches:e=>e.startsWith(t),description:()=>"startsWith "+t,equals:t=>t.description()===e.description()};return e},e.regexMatches=function(t){const e={matches:e=>t.test(e),description:()=>t.toString(),equals:t=>t.description()===e.description()};return e},e.matcher=function(t){const e={matches:e=>t(e),description:()=>t.toString(),equals:t=>t.description()===e.description()};return e}}));e(m);m.any,m.gt,m.lt,m.gte,m.lte,m.eq,m.startsWith,m.regexMatches,m.matcher;var y=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=h.deepEqual,e.SimpleEventEmitter=p.SimpleEventEmitter,e.SortedArray=d.SortedArray,e.any=m.any,e.eq=m.eq,e.gt=m.gt,e.gte=m.gte,e.lt=m.lt,e.lte=m.lte,e.matcher=m.matcher,e.regexMatches=m.regexMatches,e.startsWith=m.startsWith,e.INTERNAL_MOCKER_NAME=g.INTERNAL_MOCKER_NAME,e.printObject=g.printObject}));e(y);y.deepEqual,y.SimpleEventEmitter,y.SortedArray,y.any,y.eq,y.gt,y.gte,y.lt,y.lte,y.matcher,y.regexMatches,y.startsWith,y.INTERNAL_MOCKER_NAME,y.printObject;var x=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class n extends Error{constructor(t,e){super(e?t+"\n"+e:t)}}class r{static that(t){}static equal(t,e,r){if(!y.deepEqual(t,e))throw new n(`Expected ${y.printObject(e)} to deeply equal ${y.printObject(t)}`,r)}static notEqual(t,e,r){if(y.deepEqual(t,e))throw new n(`Expected ${y.printObject(e)} to not deeply equal ${y.printObject(t)}`,r)}static looseEqual(t,e,r){if(e!=t)throw new n(`Expected ${y.printObject(t)} == ${y.printObject(e)}`,r)}static notLooseEqual(t,e,r){if(e==t)throw new n(`Expected ${y.printObject(t)} != ${y.printObject(e)}`,r)}static strictEqual(t,e,r){if(!Object.is(e,t))throw new n(`Expected ${y.printObject(t)} to strictly equal ${y.printObject(e)}`,r)}static notStrictEqual(t,e,r){if(Object.is(e,t))throw new n(`Expected ${y.printObject(t)} to not strictly equal ${y.printObject(e)}`,r)}static is(t,e,n){r.strictEqual(t,e,n)}static has(t,e,n,s){r.exists(t,"target"),r.exists(e,"keyPath"),r.exists(t,"target");const i=e.split(".");let o=t;for(const t of i){const e=o[t];e||r.fail(`Missing key "${t}" in object ${y.printObject(o)}\nAvailable keys: ${y.printObject(Object.keys(n))}`),o=e}r.strictEqual(o,n,s)}static regexMatches(t,e,r){if(!e.test(t))throw new n(`Expected ${y.printObject(t)} to match the regex ${y.printObject(e)}`,r)}static resolvesTo(t,e,s){return t.then(t=>{r.equal(t,e)},t=>{throw new n(`Promise should not have successfully resolved.\nException: ${t}\n`,s)})}static rejects(t,e,s){const i=e instanceof Error?e.message:e;return t.then(()=>{throw new n("Promise should not have successfully resolved",s)},t=>{i&&r.equal(i,t.message)})}static fail(t){throw new n("Test failed",t)}static isTrue(t,e){r.equal(!0,t,e)}static isFalse(t,e){r.equal(!1,t,e)}static isTruthy(t,e){if(!t)throw new n(`Expected ${t} to be truthy`,e)}static isFalsy(t,e){if(t)throw new n(`Expected ${t} to be falsy`,e)}static exists(t,e){return this.notEqual(t,null,`Expected ${y.printObject(t)} to not be null. ${e}`),this.notEqual(t,void 0,`Expected ${y.printObject(t)} to not be undefined. ${e}`),!0}static contains(t,e,n){if(this.exists(t),"string"==typeof t)r.isTrue(-1!==t.indexOf(e),`String: ${e} was not found in ${t}`);else if(Array.isArray(t))r.isTrue(-1!==t.indexOf(e),`${y.printObject(e)} was not found in target array ${y.printObject(t)}. ${null!=n?n:""}`);else for(const[n,s]of Object.entries(e))r.equal(t[n],s)}static containsAll(t,e,n){this.exists(t),this.exists(e);for(const s of e)r.contains(t,s,n)}}e.Assert=r}));e(x);x.Assert;var E=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){this.target=t}toBe(t){x.Assert.equal(this.target,t)}toHaveProperty(t,e){x.Assert.has(this.target,t,e)}toBeTruthy(){x.Assert.isTruthy(this.target)}toBeFalsy(){x.Assert.isFalsy(this.target)}}e.Expect=n,e.expect=function(t){return new n(t)}}));e(E);E.Expect,E.expect;var b=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.assert=x.Assert,e.Expect=E.Expect,e.expect=E.expect}));e(b);b.assert,b.Expect,b.expect;var O=n((function(t,e){function n(t,e){return t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!r(t)||!r(e)||"object"!=typeof t&&"object"!=typeof e?t===e:function(t,e){let s,i,o,c;if(!r(t)||!r(e))return!1;if(t.prototype!==e.prototype)return!1;try{o=Object.keys(t),c=Object.keys(e)}catch(t){return!1}if(o.length!==c.length)return!1;for(o.sort(),c.sort(),s=o.length-1;s>=0;s--)if(o[s]!==c[s])return!1;for(s=o.length-1;s>=0;s--)if(i=o[s],!n(t[i],e[i]))return!1;return typeof t==typeof e}(t,e))}function r(t){return null!=t}Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=n}));e(O);O.deepEqual;var v=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.union=function(t,e){if(!t)return e||[];if(!e)return t;for(const n of e)-1===t.indexOf(n)&&t.push(n);return t},e.without=function(t,e){if(!t)return[];const n=t.indexOf(e);return-1!==n&&t.splice(n,1),t}}));e(v);v.union,v.without;var w=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.SimpleEventEmitter=class{constructor(){this.onListeners={},this.onceListeners={}}on(t,e){this.onListeners[t]=v.union(this.onListeners[t],[e])}once(t,e){this.onceListeners[t]=v.union(this.onceListeners[t],[e])}off(t,e){this.onListeners[t]=v.without(this.onListeners[t],e),this.onceListeners[t]=v.without(this.onceListeners[t],e)}emit(t,...e){if(this.onListeners[t])for(const n of this.onListeners[t])n.call(null,...e);if(this.onceListeners[t]&&this.onceListeners[t].length>0){for(const n of this.onceListeners[t])n.call(null,...e);this.onceListeners[t]=[]}}emitAndWaitForCompletion(t,...e){const n=[];if(this.onListeners[t])for(const r of this.onListeners[t])try{n.push(Promise.resolve(r.call(null,...e)))}catch(t){n.push(Promise.reject(t))}if(this.onceListeners[t]&&this.onceListeners[t].length>0){for(const r of this.onceListeners[t])try{n.push(Promise.resolve(r.call(null,...e)))}catch(t){n.push(Promise.reject(t))}this.onceListeners[t]=[]}return Promise.all(n).then(t=>{})}}}));e(w);w.SimpleEventEmitter;var M=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function n(t,e){return t<e?-1:t>e?1:0}e.SortedArray=class{constructor(t=n,e=[]){this.array=[],this.compareFunction=t||n;const r=e.length;for(let t=0;t<r;t++)this.insert(e[t])}getData(){return this.array}insert(t){let e=this.searchInternal(t)+1;const n=this.array.length-1;for(;e<n&&0===this.compareFunction(t,this.array[e]);)e++;let r=this.array.length;for(this.array.push(t);r>e;)this.array[r]=this.array[--r];this.array[e]=t}search(t){const e=this.searchInternal(t);return 0!==this.compareFunction(this.array[e],t)?-1:e}remove(t){const e=this.search(t);e>=0&&this.array.splice(e,1)}searchInternal(t){let e,n,r=this.array.length-1,s=0;for(;r>=s;)if(e=Math.floor((r+s)/2),n=this.compareFunction(this.array[e],t),n<0)s=e+1;else{if(!(n>0))return e;r=e-1}return r}}}));e(M);M.SortedArray;var j=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.INTERNAL_MOCKER_NAME="__internalMocker",e.printObject=function(t){if(null===t)return"null";if(void 0===t)return"undefined";if(t instanceof RegExp)return t.toString();const e=function(t){const e=t.__internalMocker;return null!=e?e:null}(t);return null!==e?e.mockName:JSON.stringify(t)}}));e(j);j.INTERNAL_MOCKER_NAME,j.printObject;var _=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.any=function(){const t={precedence:-1,matches:()=>!0,description:()=>"any()",equals:e=>e.description()===t.description()};return t},e.gt=function(t){const e={matches:e=>e>t,description:()=>`gt(${j.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.lt=function(t){const e={matches:e=>e<t,description:()=>`lt(${j.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.gte=function(t){const e={matches:e=>e>=t,description:()=>`gte(${j.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.lte=function(t){const e={matches:e=>e<=t,description:()=>`lte(${j.printObject(t)})`,equals:t=>t.description()===e.description()};return e},e.eq=function(t){const e={precedence:1,matches:e=>O.deepEqual(t,e),description:()=>j.printObject(t),equals:t=>t.description()===e.description()};return e},e.startsWith=function(t){const e={matches:e=>e.startsWith(t),description:()=>"startsWith "+t,equals:t=>t.description()===e.description()};return e},e.regexMatches=function(t){const e={matches:e=>t.test(e),description:()=>t.toString(),equals:t=>t.description()===e.description()};return e},e.matcher=function(t){const e={matches:e=>t(e),description:()=>t.toString(),equals:t=>t.description()===e.description()};return e}}));e(_);_.any,_.gt,_.lt,_.gte,_.lte,_.eq,_.startsWith,_.regexMatches,_.matcher;var P=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.deepEqual=O.deepEqual,e.SimpleEventEmitter=w.SimpleEventEmitter,e.SortedArray=M.SortedArray,e.any=_.any,e.eq=_.eq,e.gt=_.gt,e.gte=_.gte,e.lt=_.lt,e.lte=_.lte,e.matcher=_.matcher,e.regexMatches=_.regexMatches,e.startsWith=_.startsWith,e.INTERNAL_MOCKER_NAME=j.INTERNAL_MOCKER_NAME,e.printObject=j.printObject}));e(P);P.deepEqual,P.SimpleEventEmitter,P.SortedArray,P.any,P.eq,P.gt,P.gte,P.lt,P.lte,P.matcher,P.regexMatches,P.startsWith,P.INTERNAL_MOCKER_NAME,P.printObject;var T=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this.all=[]}get first(){return 0===this.all.length?null:this.all[0]}get last(){return 0===this.all.length?null:this.all[this.all.length-1]}matches(t){return this.all.push(t),!0}description(){return 0===this.all.length?"Argument captor. No arguments captured":"Argument captor. Currently captured args: "+this.all}equals(t){return t instanceof n&&t.all===this.all}}e.newCapture=function(){return new n}}));e(T);T.newCapture;var A=n((function(t,e){function n(t){const e=t[P.INTERNAL_MOCKER_NAME];return null!=e?e:null}Object.defineProperty(e,"__esModule",{value:!0}),e.INTERNAL_MOCKER_NAME=P.INTERNAL_MOCKER_NAME,e.GetInternalMockerSafe=n,e.GetInternalMocker=function(t){const e=n(t);if(null===e)throw new Error("Passed an object that was not a mock. Object: "+t.toString());return e},e.CreateInternalMocker=function(t,e,n,r){const s={expectations:[],recordedInvocations:[],realFunction:e,options:r,inProgressInOrder:[],isInExpectation:!1,mockName:null!=n?n:"mock"};return t[P.INTERNAL_MOCKER_NAME]=s,s}}));e(A);A.INTERNAL_MOCKER_NAME,A.GetInternalMockerSafe,A.GetInternalMocker,A.CreateInternalMocker;var k=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.StacktraceUtils=class{static getCurrentMockLocation(t){const e=(new Error).stack;if(void 0===e)return null;const n=e.split("\n");if(n.length<t+2)return null;const r=n[t+1],s=/.*?\((.*?)\)/.exec(r);return null===s?null:s[1]}}}));e(k);k.StacktraceUtils;var q=n((function(t,e){function n(t,e){const n=new P.SortedArray((t,e)=>{if(void 0===t&&void 0===e)return 0;if(void 0===t)return 1;if(void 0===e)return-1;if(null!==t.inOrderOverride&&null==e.inOrderOverride)return-1;if(null===t.inOrderOverride&&null!==e.inOrderOverride)return 1;if(null===t.expectedArgs&&null===e.expectedArgs)return 0;if(null===t.expectedArgs)return 1;if(null===e.expectedArgs)return-1;const n=e.expectedArgs.length-t.expectedArgs.length;if(0!==n)return n;const s=r(t.expectedArgs);return r(e.expectedArgs)-s});for(const e of t)n.insert(e);for(const t of n.getData()){if(t.callCount>=t.expectedRange.end)continue;if(s(t.expectedArgs,e))return t}return null}function r(t){let e=0;for(const n of t)e+=void 0!==n.precedence?n.precedence:0;return e}function s(t,e){if(null===t)return!0;if(e.length<t.length)return!1;let n=!0;0===t.length&&(n=0===e.length);for(let r=0;r<t.length;r++){const s=t[r],i=e[r];n=n&&s.matches(i)}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.findBestArgumentMatcher=n,e.verifyArgumentMatcher=s;const i={includeLocation:!0};function o(t,e=i){let n="\t"+(t.internalMocker.mockName||"mock");if(null===t.expectedArgs)n+="() with any arguments";else{const e=[];for(const n of t.expectedArgs)n.description?e.push(n.description()):e.push(n.toString());n+=`(${e.join(", ")})`}return n+=`. Expected ${t.expectedRange.describeRange()}, so far ${t.callCount}.`,e.includeLocation&&(n+="\n\tExpectation set at "+t.location),n+"\n"}e.createMockedFunction=function(){const t=(...e)=>{const r=A.GetInternalMocker(t),s=k.StacktraceUtils.getCurrentMockLocation(2);r.recordedInvocations.push({params:e,location:s});const i=n(r.expectations,e);if(null!==i){if(i.inOrderOverride){const t=i.inOrderOverride,e=t.expectations[t.currentIndex];if(e!==i){const t=o(e);throw new Error(`Out of order method call.\nExpected:\n${t}\nActual:\n`+o(i,{includeLocation:!1})+"\tCalled at "+s)}if(0===t.currentIndex&&r.inProgressInOrder.push(t),t.currentIndex++,t.currentIndex>t.expectations.length){const e=r.inProgressInOrder.indexOf(t);if(-1===e)throw new Error("Could not find in progress index");r.inProgressInOrder.splice(e,1)}}else if(r.inProgressInOrder.length>0)throw new Error("Out of order method call.");if(i.callCount++,!i.answer)return;return i.answer(...e)}if(r.options.strictMode===$.StrictnessMode.Strict){let n="";for(const t of r.expectations)n+=o(t)+"\n";n=n?`\nExpectations:\n${n} `:"";const s=r.expectations.length>0?"matched":"was set",i=[];for(const t of e)i.push(P.printObject(t));const c=i.join(", ");throw new Error(`${t.name}(${c}) was called but no expectation ${s}.${n}`)}return null};return t}}));e(q);q.findBestArgumentMatcher,q.verifyArgumentMatcher,q.createMockedFunction;var S=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class n extends Error{constructor(t,e){super(e?t+"\n"+e:t)}}class r{static that(t){}static equal(t,e,r){if(!P.deepEqual(t,e))throw new n(`Expected ${P.printObject(e)} to deeply equal ${P.printObject(t)}`,r)}static notEqual(t,e,r){if(P.deepEqual(t,e))throw new n(`Expected ${P.printObject(e)} to not deeply equal ${P.printObject(t)}`,r)}static looseEqual(t,e,r){if(e!=t)throw new n(`Expected ${P.printObject(t)} == ${P.printObject(e)}`,r)}static notLooseEqual(t,e,r){if(e==t)throw new n(`Expected ${P.printObject(t)} != ${P.printObject(e)}`,r)}static strictEqual(t,e,r){if(!Object.is(e,t))throw new n(`Expected ${P.printObject(t)} to strictly equal ${P.printObject(e)}`,r)}static notStrictEqual(t,e,r){if(Object.is(e,t))throw new n(`Expected ${P.printObject(t)} to not strictly equal ${P.printObject(e)}`,r)}static is(t,e,n){r.strictEqual(t,e,n)}static has(t,e,n,s){r.exists(t,"target"),r.exists(e,"keyPath"),r.exists(t,"target");const i=e.split(".");let o=t;for(const t of i){const e=o[t];e||r.fail(`Missing key "${t}" in object ${P.printObject(o)}\nAvailable keys: ${P.printObject(Object.keys(n))}`),o=e}r.strictEqual(o,n,s)}static regexMatches(t,e,r){if(!e.test(t))throw new n(`Expected ${P.printObject(t)} to match the regex ${P.printObject(e)}`,r)}static resolvesTo(t,e,s){return t.then(t=>{r.equal(t,e)},t=>{throw new n(`Promise should not have successfully resolved.\nException: ${t}\n`,s)})}static rejects(t,e,s){const i=e instanceof Error?e.message:e;return t.then(()=>{throw new n("Promise should not have successfully resolved",s)},t=>{i&&r.equal(i,t.message)})}static fail(t){throw new n("Test failed",t)}static isTrue(t,e){r.equal(!0,t,e)}static isFalse(t,e){r.equal(!1,t,e)}static isTruthy(t,e){if(!t)throw new n(`Expected ${t} to be truthy`,e)}static isFalsy(t,e){if(t)throw new n(`Expected ${t} to be falsy`,e)}static exists(t,e){return this.notEqual(t,null,`Expected ${P.printObject(t)} to not be null. ${e}`),this.notEqual(t,void 0,`Expected ${P.printObject(t)} to not be undefined. ${e}`),!0}static contains(t,e,n){if(this.exists(t),"string"==typeof t)r.isTrue(-1!==t.indexOf(e),`String: ${e} was not found in ${t}`);else if(Array.isArray(t))r.isTrue(-1!==t.indexOf(e),`${P.printObject(e)} was not found in target array ${P.printObject(t)}. ${null!=n?n:""}`);else for(const[n,s]of Object.entries(e))r.equal(t[n],s)}static containsAll(t,e,n){this.exists(t),this.exists(e);for(const s of e)r.contains(t,s,n)}}e.Assert=r}));e(S);S.Assert;var R=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){this.target=t}toBe(t){S.Assert.equal(this.target,t)}toHaveProperty(t,e){S.Assert.has(this.target,t,e)}toBeTruthy(){S.Assert.isTruthy(this.target)}toBeFalsy(){S.Assert.isFalsy(this.target)}}e.Expect=n,e.expect=function(t){return new n(t)}}));e(R);R.Expect,R.expect;var L=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.assert=S.Assert,e.Expect=R.Expect,e.expect=R.expect}));e(L);L.assert,L.Expect,L.expect;var C=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.Range=class{constructor(t,e=t){if(t<0)throw new Error("Start value must be >= 0. Received "+t);if(e<1)throw Error("End value must be >= 1. Received "+e);if(t>e)throw new Error(`Start must be <= end. Start: ${t} End: ${e}`);this.start=t,this.end=e}isFixedRange(){return this.start===this.end}isInRange(t){return t>=this.start&&t<=this.end}hasNoUpperBound(){return this.end===Number.MAX_SAFE_INTEGER}describeRange(){return this.isFixedRange()?this.start+" invocations":this.hasNoUpperBound()?`at least ${this.start} invocations`:`between ${this.start} and ${this.end} invocations`}}}));e(C);C.Range;var I=n((function(t,e){function n(t){return function(){return t}}function r(t){const e=[];for(const n of t){const t=null===A.GetInternalMockerSafe(n)&&"function"==typeof n.matches?n:P.eq(n);e.push(t)}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.normalizeMatcherArgs=r;class s extends L.Expect{constructor(t){super(t),this.atMostCount=-1,this.atLeastCount=-1,this.timesCount=-1,this.internalMocker=A.GetInternalMocker(t),this.currentArgumentExpectations=null,this.internalMocker.isInExpectation=!0;const e={internalMocker:this.internalMocker,expectedRange:new C.Range(1),location:k.StacktraceUtils.getCurrentMockLocation(3),answer:null,expectedArgs:this.currentArgumentExpectations,callCount:0,inOrderOverride:null};this.internalMocker.expectations.push(e),this.expectation=e}getExpectation(){return this.expectation}withArgs(...t){return this.currentArgumentExpectations=r(t),this.expectation.expectedArgs=this.currentArgumentExpectations,this}andReturn(t){return this.expectation.answer=n(t),this}andStubReturn(t){this.expectation.answer=n(t),this.atLeast(0)}andThrow(t){return this.expectation.answer=function(t){return function(){throw t}}(t),this}andCallRealMethod(){const t=this.internalMocker.realFunction;if(!t)throw new Error("No function was available. Ensure a real object was passed to the spy");return this.expectation.answer=function(t){return function(...e){return t(e)}}(t),this}andAnswer(t){return this.expectation.answer=t,this}andResolve(t){return this.expectation.answer=function(t){return function(){return Promise.resolve(t)}}(t),this}andReject(t){return this.expectation.answer=function(t){return function(){return Promise.reject(t)}}(t),this}times(t){if(-1!==this.timesCount||-1!==this.atLeastCount||-1!==this.atMostCount)throw new Error("Previously set expectation count, value must only be set once");return this.timesCount=t,this.setExpectedRange(new C.Range(t)),this}once(){return this.times(1)}twice(){return this.times(2)}atMost(t){if(-1!==this.timesCount||-1!==this.atMostCount&&this.atMostCount!==Number.MAX_SAFE_INTEGER)throw new Error("Previously set expectation count, value must only be set once");return this.atMostCount=t,this.atLeastCount=-1!==this.atLeastCount?this.atLeastCount:0,this.setExpectedRange(new C.Range(this.atLeastCount,this.atMostCount)),this}atLeast(t){if(-1!==this.timesCount||-1!==this.atLeastCount&&0!==this.atLeastCount)throw new Error("Previously set expectation count, value must only be set once");return this.atLeastCount=t,this.atMostCount=-1!==this.atMostCount?this.atMostCount:Number.MAX_SAFE_INTEGER,this.setExpectedRange(new C.Range(this.atLeastCount,this.atMostCount)),this}setExpectedRange(t){const e=this.internalMocker.expectations;if(e.length>1&&t.isFixedRange()){const t=e[e.length-1],n=e[e.length-2];if(!n.expectedRange.isFixedRange()&&this.doArgumentsMatch(n,t))throw new Error("Previous expectation had a non fixed range.")}this.expectation.expectedRange=t}doArgumentsMatch(t,e){if(null===e.expectedArgs||null===t.expectedArgs)return null===t.expectedArgs&&null===e.expectedArgs;if(e.expectedArgs.length!==t.expectedArgs.length)return!1;for(let n=0;n<e.expectedArgs.length;n++){const r=t.expectedArgs[n];if(!e.expectedArgs[n].equals(r))return!1}return!0}}e.OnGoingStubs=s}));e(I);I.normalizeMatcherArgs,I.OnGoingStubs;var $=n((function(t,e){var n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Strict=0]="Strict",t[t.Loose=1]="Loose"}(n||(n={})),e.StrictnessMode=n;class r{constructor(t,e,n,r){this.cachedStubs={},this.cachedFunctionStub=null,this.clazz=t,this.realObject=e,this.mockName=n,this.options=r}apply(t,e,n){if(t===this.realObject)return this.mockSingleFunctionIfNecessary(this.realObject),this.cachedFunctionStub(...n);t(n)}get(t,e,n){if(e===A.INTERNAL_MOCKER_NAME||void 0!==Object.getPrototypeOf(Function)[e])return this.mockSingleFunctionIfNecessary(t[e]),this.cachedFunctionStub[e];if(this.clazz){const t=this.clazz[e];if(null==t){const t=Object.getOwnPropertyNames(this.clazz).join(", ");throw new Error(`Method "${e.toString()}" was called on class "${this.clazz.constructor.name}". Ensure method exists on prototype. Valid methods: [${t}]`)}}if(!this.cachedStubs[e]){const n=q.createMockedFunction(),r=null!==this.mockName?`${this.mockName}.${e.toString()}`:e.toString();Object.defineProperty(n,"name",{value:r});const s=A.CreateInternalMocker(n,t[e],r,this.options);s.isInExpectation&&(s.isInExpectation=!1),this.cachedStubs[e]=n}return this.cachedStubs[e]}enumerate(t){return this.ownKeys(t)}ownKeys(t){return Object.keys(this.cachedStubs)}getOwnPropertyDescriptor(t,e){return Object.getOwnPropertyDescriptor(this.cachedStubs,e)}isExtensible(t){return!1}mockSingleFunctionIfNecessary(t){if(!this.cachedFunctionStub){const e=q.createMockedFunction();null!==this.mockName&&Object.defineProperty(e,"name",{value:this.mockName});const n=A.CreateInternalMocker(e,t,this.mockName,this.options);n.isInExpectation&&(n.isInExpectation=!1),this.cachedFunctionStub=e}}}let s={strictMode:n.Strict,inOrder:!1};e.setDefaultOptions=function(t){s=Object.assign(s,t)},e.mock=function(t,e,n=s){const i=()=>{};return"string"==typeof t&&(e=t,t=void 0),e||(e=null),new Proxy(i,new r(t?t.prototype:null,i,e,n))},e.spy=function(t,e=s){return new Proxy(t,new r(Object.getPrototypeOf(t),t,null,e))},e.expect=function(t){return new I.OnGoingStubs(t)},e.inOrder=function(...t){const e={expectations:[],currentIndex:0},n=t;for(const t of n){const n=t.getExpectation();e.expectations.push(n),n.inOrderOverride=e}}}));e($);$.StrictnessMode,$.setDefaultOptions,$.mock,$.spy,$.expect,$.inOrder;var N=n((function(t,e){function n(t){const e=A.GetInternalMocker(t),s=Object.keys(t);for(const e of s){if(e===A.INTERNAL_MOCKER_NAME)continue;const r=t[e];if(r){A.GetInternalMocker(r)&&n(r)}}for(const t of e.expectations)if(!t.expectedRange.isInRange(t.callCount))throw new Error(r(e.recordedInvocations,t))}function r(t,e){const n=function(t,e){const n=[];for(const r of e)null===t&&null!==r.location&&n.push(r.location);return n}(e.expectedArgs,t),r=(s=e.expectedRange,i=e.callCount,`Expected ${s.describeRange()}, got ${i}.`);var s,i;const o=n.length>0?"Called at:\n"+n.join("\n"):"";return`${r}\nExpected at: ${e.location}\n${o}\n `}Object.defineProperty(e,"__esModule",{value:!0}),e.verify=function(...t){for(const e of t)n(e)}}));e(N);N.verify;var F=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.any=P.any,e.eq=P.eq,e.gt=P.gt,e.gte=P.gte,e.lt=P.lt,e.lte=P.lte,e.matcher=P.matcher,e.regexMatches=P.regexMatches,e.startsWith=P.startsWith,e.newCapture=T.newCapture,e.expect=$.expect,e.inOrder=$.inOrder,e.mock=$.mock,e.setDefaultOptions=$.setDefaultOptions,e.spy=$.spy,e.verify=N.verify}));e(F);F.any,F.eq,F.gt,F.gte,F.lt,F.lte,F.matcher,F.regexMatches,F.startsWith,F.newCapture,F.expect,F.inOrder,F.mock,F.setDefaultOptions,F.spy,F.verify;var D=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TestRunner=l.TestRunner,e.assert=b.assert,e.any=F.any,e.eq=F.eq,e.expect=F.expect,e.gt=F.gt,e.gte=F.gte,e.inOrder=F.inOrder,e.lt=F.lt,e.lte=F.lte,e.matcher=F.matcher,e.mock=F.mock,e.newCapture=F.newCapture,e.regexMatches=F.regexMatches,e.setMockOptions=F.setDefaultOptions,e.spy=F.spy,e.startsWith=F.startsWith,e.verify=F.verify})),Q=e(D),W=D.TestRunner,K=D.assert,G=D.any,B=D.eq,z=D.expect,U=D.gt,V=D.gte,X=D.inOrder,H=D.lt,J=D.lte,Y=D.matcher,Z=D.mock,tt=D.newCapture,et=D.regexMatches,nt=D.setMockOptions,rt=D.spy,st=D.startsWith,it=D.verify;exports.TestRunner=W,exports.any=G,exports.assert=K,exports.default=Q,exports.eq=B,exports.expect=z,exports.gt=U,exports.gte=V,exports.inOrder=X,exports.lt=H,exports.lte=J,exports.matcher=Y,exports.mock=Z,exports.newCapture=tt,exports.regexMatches=et,exports.setMockOptions=nt,exports.spy=rt,exports.startsWith=st,exports.verify=it;
//# sourceMappingURL=umbra.js.map
